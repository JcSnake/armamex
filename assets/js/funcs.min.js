/**
 * Global variables
 */

var isOnDebbug = true;
var version = 1.0;
var release = 1;

var NOTIFY_POS = { 'TOP_CENTER': 'top-center', 'TOP_LEFT': 'top_left', 'TOP_RIGHT': 'top_right' }
var NOTIFY_STS = { 'SUCCESS': 'success', 'FAIL': 'danger'}

/**
 * Methods
 */

$(document).ready(function() {
    setFrmStyle($(window).width());
    setButtonTopBottom($(window).width());
    setListeners();
});

$(window).resize(function() {
    setFrmStyle($(window).width());
    setButtonTopBottom($(window).width());
});

$(window).scroll(function(e) {
    if($(window).scrollTop() >= 1200) {
        $('#am-top-button')[0].classList.remove('uk-hidden');
    } else {
        $('#am-top-button')[0].classList.add('uk-hidden');
    }
});

function setListeners() {
    $('#am-top-button').click(function() {
        UIkit.Utils.scrollToElement(UIkit.$('#am-top'));
    });

    $('#am-send-contact').click(function() {
        if(validateContactForm()) {
            sendContactForm();
        }
    });

    $('#am-send-fletamentos').click(function() {
        if(validateSolicitanteForm() && validateFletamentosForm()) {
           showNotification(LNG.succ.success_validation, NOTIFY_STS.SUCCESS, NOTIFY_POS.TOP_CENTER);
           return true;
        }else{
            showNotification(LNG.err.fail_validation, NOTIFY_STS.FAIL, NOTIFY_POS.TOP_CENTER);
            return false;
        }
    });

    $('#am-send-trans').click(function() {
        if(validateSolicitanteForm() || validateTransMarForm()) {
            showNotification(LNG.succ.success_validation, NOTIFY_STS.SUCCESS, NOTIFY_POS.TOP_CENTER);
            return true;
        } else {
            showNotification(LNG.err.fail_validation, NOTIFY_STS.FAIL, NOTIFY_POS.TOP_CENTER);
            return false;
        }
    });

    $('#am-send-remolque').click(function(){
        if(validateSolicitanteForm() && validateRemolqueForm()) {
            showNotification(LNG.succ.success_validation, NOTIFY_STS.SUCCESS, NOTIFY_POS.TOP_CENTER);
            return true;
           
        } else {
            showNotification(LNG.err.fail_validation, NOTIFY_STS.FAIL, NOTIFY_POS.TOP_CENTER);
            return false;
        }
    });

    $('#cotizacionType').change(function() {
        var index = this.selectedIndex;
        setCotizacionFormsHide();

        switch (index) {
            case 1:
                $('#cotizacionOpt1')[0].classList.remove('uk-hidden');
                    document.getElementById("cotizacionOpt1Frm").reset();
                break;
            case 2:
                $('#cotizacionOpt2')[0].classList.remove('uk-hidden');
                    document.getElementById("cotizacionOpt2Frm").reset();
                break;
            case 3:
                $('#cotizacionOpt3')[0].classList.remove('uk-hidden');
                    document.getElementById("cotizacionOpt3Frm").reset();
                break;
        }

        if(index > 0) {
            UIkit.Utils.scrollToElement(UIkit.$('#am-cotizacion'), {offset: -290});
        }
    });

    $('.am-menu-link').hover(function() {
        changeNavIcon(this, true);
    }, function() {
        changeNavIcon(this, false);
    });
}

function changeNavIcon(e, isHover) {
    var img = e.firstElementChild.firstElementChild.firstElementChild;
    var src = img.src;
    var lbl = e.firstElementChild.lastElementChild;

    if(isHover) {
        img.src = src.replace('.svg', '_hover.svg');
        lbl.classList.add('am-text-menu-hover');
    } else {
        img.src = src.replace('_hover.svg', '.svg');
        lbl.classList.remove('am-text-menu-hover');
    }
}

function setButtonTopBottom(width) {
    var btnTop = $('#am-top-button')[0];

    if(width <= 767) {
        btnTop.style.bottom = "85px";
        btnTop.style.right = "10px";
        btnTop.style.height = "45px";
        btnTop.style.width = "45px";
    }  else {
        btnTop.style.bottom = "50px";
        btnTop.style.right = "10px";
        btnTop.style.height = "50px";
        btnTop.style.width = "50px";
    }
}

function setCotizacionFormsHide() {
    $('#cotizacionOpt1')[0].classList.add('uk-hidden');
    $('#cotizacionOpt2')[0].classList.add('uk-hidden');
    $('#cotizacionOpt3')[0].classList.add('uk-hidden');
}

function setFrmStyle(frameWidth) {
    if(frameWidth <= 767) {
        $('#contactFrm')[0].classList.remove('uk-form-horizontal');
        $('#solicitanteFrm')[0].classList.remove('uk-form-horizontal');
        $('#cotizacionOpt1Frm')[0].classList.remove('uk-form-horizontal');
        $('#cotizacionOpt2Frm')[0].classList.remove('uk-form-horizontal');
        $('#cotizacionOpt3Frm')[0].classList.remove('uk-form-horizontal');
    } else {
        $('#contactFrm')[0].classList.add('uk-form-horizontal');
        $('#solicitanteFrm')[0].classList.add('uk-form-horizontal');
        $('#cotizacionOpt1Frm')[0].classList.add('uk-form-horizontal');
        $('#cotizacionOpt2Frm')[0].classList.add('uk-form-horizontal');
        $('#cotizacionOpt3Frm')[0].classList.add('uk-form-horizontal');
    }
}

function validateContactForm() {
    var frmName = $('#frmName')[0];
    var frmEmail = $('#frmEmail')[0];
    var frmPhone = $('#frmPhone')[0];
    var frmMessage = $('#frmMessage')[0];
    
    var vName = validateName(frmName, frmName.value);
    var vEmail = validateEmail(frmEmail, frmEmail.value);
    var vPhone = validatePhone(frmPhone, frmPhone.value);

    if(vName && vEmail && vPhone) {
        return true;
    } else {
        showNotification(LNG.err.fail_validation, NOTIFY_STS.FAIL, NOTIFY_POS.TOP_CENTER);
        return false;
    }
}

function validateSolicitanteForm() {
    var frmName = $('#cotizacionName')[0];
    var frmEmail = $('#cotizacionEmail')[0];
    var frmService = $('#cotizacionService')[0];
    var frmPhone = $('#cotizacionPhone')[0];
    var frmFletador = $('#cotizacionFletador')[0];
    
    var vName = validateName(frmName, frmName.value);
    var vEmail = validateEmail(frmEmail, frmEmail.value);
    var vService = validateService(frmService, frmService.value);
    var vPhone = validatePhone(frmPhone, frmPhone.value);
    var vFletador = validateFletador(frmFletador, frmFletador.value);

    if(vName && vEmail && vService && vPhone && vFletador) {
        return true;
    } 
}

function validateFletamentosForm() {
    var frmQuantity = $('#cotOpt1Quantity')[0];
    var frmFleta = $('#cotOpt1Type')[0];
    var frmCapacity = $('#cotOpt1Capacity')[0];
    var frmArea = $('#cotOpt1Area')[0];
    var frmEntrega = $('#cotOpt1Entrega')[0];
    var frmPrincipal = $('#cotOpt1Principal')[0];
    var frmExtension = $('#cotOpt1Extension')[0];
    
    var vQuantity = validateQuantity (frmQuantity, frmQuantity.value);
    var vFleta = validateFleta(frmFleta, frmFleta.value);
    var vCapacity = validateCapacity(frmCapacity, frmCapacity.value);
    var vArea = validateArea(frmArea, frmArea.value);
    var vEntrega = validateEntrega(frmEntrega, frmEntrega.value);
    var vPrincipal = validatePrincipal(frmPrincipal, frmPrincipal.value);
    var vExtension = validateExtension(frmExtension, frmExtension.value);
    
    if(vQuantity && vFleta && vCapacity && vArea && vEntrega && vPrincipal && vExtension) {
        return true;
    }
}

function validateTransMarForm() {
    var frmDateEm = $('#cotOpt3Salida')[0];
    var frmQuantity = $('#cotOpt3Peso')[0];
    var frmTypeCarga = $('#cotOpt3Esolra')[0];
    var frmSysCarga = $('#cotOpt3Calado')[0];
    var frmSysDes = $('#cotOpt3TRB')[0];
    var frmEntrada2 = $('#cotOpt3Entrada')[0];
    var frmRaOp1 = $('#cotOpt1TripulacionSob')[0];
    var frmRaOp2 = $('#cotOpt2TripulacionGra')[0];
    var frmRaOp3 = $('#cotOpt3TripulacionLiq')[0];
    var frmRaOp4 = $('#cotOpt4TripulacionSol')[0];
    
    var vDateEm = validateDateEm(frmDateEm, frmDateEm.value);
    var vQuantity = validateQuantity(frmQuantity, frmQuantity.value);
    var vTypeCarga = validateTypeCarga(frmTypeCarga, frmTypeCarga.value);
    var vSysCarga = validateSysCarga(frmSysCarga, frmSysCarga.value);
    var vSysDes = validateSysDes(frmSysDes, frmSysDes.value);
    var vEntrada2 = validateEntrada (frmEntrada2, frmEntrada2.value);
    
    if(vDateEm && vQuantity && vTypeCarga && vSysCarga && vSysDes && vEntrada2) {
        return true;
    }
}

function sendEmailContact(frm) {

    var data = 'nombre=' + frm.frmName.value + '&telefono=' + frm.frmPhone.value + '&correo=' + frm.frmEmail.value + '&mensaje=' + frm.frmMessage.value;

	$.ajax({
		timeout: 25000,
		type: 'POST',
		url: '/app/ws/sendEmail.php',
		data: data,
		beforeSend: function() {
			frm.enviar.className += 'uk-hidden';
		},
		success: function(response) {
			var msg = '';

			if(response == 1) {
				msg = 'T&uacute; mensaje ha sido enviado con &eacute;xito. En breve nos comunicaremos contigo para darle seguimiento a tus comentarios.';
				frm.frmName.value = '';
				frm.frmPhone.value = '';
				frm.frmEmail.value = '';
				frm.frmMessage.value = '';
			} else {
				msg = 'No se pudo enviar tu mensaje por este medio, le recomendamos intentar de nuevo o enviar un correo directo a <a href="mailto:contacto@maspm.lat?subject=Error en el formulario">contacto@maspm.lat</a>.<br><br>Gracias por contactarnos.';
				console.log(response);
			}

			alertUser(msg);
			frm.enviar.className += 'uk-button uk-width-1-1';
		},
		error: function(xhr, status, error) {
			console.log(error);
			frm.enviar.className += 'uk-button uk-width-1-1';
			alertUser('Se genero un error al tratar de enviar sus comentarios, le recomendamos intentar de nuevo o enviar un correo directo a <a href="mailto:contacto@maspm.lat?subject=Error en el formulario">contacto@maspm.lat</a>.<br><br>Gracias por contactarnos.');
		}
	});
}

function validateName(objName, strName) {
    clearAlertsInForm(objName);

    if(strName != '' && isNaN(strName)) {
        objName.classList.add('am-form-success');
        return true;
    } else {
        objName.classList.add('am-form-danger');
        return false;
    }
}

function validateEmail(objEmail, strEmail) {
    var regex = /^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;
    clearAlertsInForm(objEmail);

    if(regex.test(strEmail)) {
        objEmail.classList.add('am-form-success');
        return true;
    } else {
        objEmail.classList.add('am-form-danger');
        return false;
    }
}

function validateService(objService, strService) {
    clearAlertsInForm(objService);

    if(strService != '' && isNaN(strService)) {
        objService.classList.add('am-form-success');
        return true;
    } else {
        objService.classList.add('am-form-danger');
        return false;
    }
}

function validatePhone(objPhone, strPhone) {
    clearAlertsInForm(objPhone);

    if(strPhone != '' && strPhone.length == 10 && !isNaN(strPhone)) {
        objPhone.classList.add('am-form-success');
        return true;
    } else {
        objPhone.classList.add('am-form-danger');
        return false;
    }
}

function validateFletador(objFletador, strFletador) {
    clearAlertsInForm(objFletador);

    if(strFletador != '' && isNaN(strFletador)) {
        objFletador.classList.add('am-form-success');
        return true;
    } else {
        objFletador.classList.add('am-form-danger');
        return false;
    }
}

function validateQuantity(objQuantity, strQuantity) {
    clearAlertsInForm(objQuantity);

    if(strQuantity != ''&& !isNaN(strFletador)) {
        objQuantity.classList.add('am-form-success');
        return true;
    } else {
        objQuantity.classList.add('am-form-danger');
        return false;
    }
}

function validateFleta(objFleta, strFleta) {
    clearAlertsInForm(objFleta);

    if(strFleta != '' && isNaN(strFleta)) {
        objFleta.classList.add('am-form-success');
        return true;
    } else {
        objFleta.classList.add('am-form-danger');
        return false;
    }
}

function validateRemolqueForm() {
    var frmSalida = $('#cotOpt2Salida')[0];
    var frmPeso = $('#cotOpt2Peso')[0];
    var frmEslora = $('#cotOpt2Esolra')[0];
    var frmCalado = $('#cotOpt2Calado')[0];
    var frmTRB = $('#cotOpt2TRB')[0];
    var frmEntrada = $('#cotOpt2Entrada')[0];
    var frmDesplazamiento = $('#cotOpt2Desplazamiento')[0];
    var frmCondicion = $('#cotOpt2Condicion')[0];

    var vSalida = validateSalida(frmSalida, frmSalida.value);
    var vPeso = validatePeso(frmPeso, frmPeso.value);
    var vEslora = validateEslora(frmEslora, frmEslora.value);
    var vCalado = validateCalado(frmCalado, frmCalado.value);
    var vTRB = validateTRB(frmTRB, frmTRB.value);
    var vEntrada = validateEntrada(frmEntrada, frmEntrada.value);
    var vDesplazamiento = validateDesplazamiento(frmDesplazamiento, frmDesplazamiento.value);
    var vCondicion = validateCondicion(frmCondicion, frmCondicion.value);

    if(vSalida && vPeso && vEslora && vCalado && vTRB && vEntrada && vDesplazamiento && vCondicion) {
        return true;
    } 
}

function validateSalida(objSalida, strSalida) {
    clearAlertsInForm(objSalida);

    if(strSalida != '' && strSalida.length >= 5 && isNaN(strSalida)) {
        objSalida.classList.add('am-form-success');
        return true;
    } else {
        objSalida.classList.add('am-form-danger');
        return false;
    }
}

function validatePeso(objPeso, strPeso) {
    clearAlertsInForm(objPeso);

    if(strPeso != '') {
        objPeso.classList.add('am-form-success');
        return true;
    } else {
        objPeso.classList.add('am-form-danger');
        return false;
    }
}

function validateEslora(objEslora, strEslora) {
    clearAlertsInForm(objEslora);

    if(strEslora != '') {
        objEslora.classList.add('am-form-success');
        return true;
    } else {
        objEslora.classList.add('am-form-danger');
        return false;
    }
}

function validateCalado(objCalado, strCalado) {
    clearAlertsInForm(objCalado);

    if(strCalado != '') {
        objCalado.classList.add('am-form-success');
        return true;
    } else {
        objCalado.classList.add('am-form-danger');
        return false;
    }
}

function validateDateEm(objDateEm, strDateEm) {
    clearAlertsInForm(objDateEm);

    if(strDateEm != '' && !isNaN(strFleta)) {
        objDateEm.classList.add('am-form-success');
        return true;
    } else {
        objDateEm.classList.add('am-form-danger');
        return false;
    }
}

function validateTRB(objTRB, strTRB) {
    clearAlertsInForm(objTRB);

    if(strTRB != '') {
        objTRB.classList.add('am-form-success');
        return true;
    } else {
        objTRB.classList.add('am-form-danger');
        return false;
    }
}

function validateQuantity(objQuantity, strQuantity) {
    clearAlertsInForm(objQuantity);

    if(strQuantity != '') {
        objQuantity.classList.add('am-form-success');
        return true;
    } else {
        objQuantity.classList.add('am-form-danger');
        return false;
    }
}

function validateEntrada(objEntrada, strEntrada) {
    clearAlertsInForm(objEntrada);

    if(strEntrada != '') {
        objEntrada.classList.add('am-form-success');
        return true;
    } else {
        objEntrada.classList.add('am-form-danger');
        return false;
    }
}

function validateDesplazamiento(objDesplazamiento, strDesplazamiento) {
    clearAlertsInForm(objDesplazamiento);

    if(strDesplazamiento != '') {
        objDesplazamiento.classList.add('am-form-success');
        return true;
    } else {
        objDesplazamiento.classList.add('am-form-danger');
        return false;
    }
}

function validateCondicion(objCondicion, strCondicion) {
    clearAlertsInForm(objCondicion);

    if(strCondicion != '') {
        objCondicion.classList.add('am-form-success');
        return true;
    } else {
        objCondicion.classList.add('am-form-danger');
        return false;
    }
}

function validateTypeCarga(objTypeCarga, strTypeCarga) {
    clearAlertsInForm(objTypeCarga);

    if(strTypeCarga != '') {
        objTypeCarga.classList.add('am-form-success');
        return true;
    } else {
        objTypeCarga.classList.add('am-form-danger');
        return false;
    }
}

function validateName(objName, strName) {
    clearAlertsInForm(objName);

    if(strName != '' && strName.length >= 5 && isNaN(strName)) {
        objName.classList.add('am-form-success');
        return true;
    } else {
        objName.classList.add('am-form-danger');
        return false;
    }
}

function validateEntrada(objEntrada, strEntrada) {
    clearAlertsInForm(objEntrada);

    if(strEntrada != '') {
        objEntrada.classList.add('am-form-success');
        return true;
    } else {
        objEntrada.classList.add('am-form-danger');
        return false;
    }
}

function validateEmail(objEmail, strEmail) {
    var regex = /^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;
    clearAlertsInForm(objEmail);

    if(regex.test(strEmail)) {
        objEmail.classList.add('am-form-success');
        return true;
    } else {
        objEmail.classList.add('am-form-danger');
        return false;
    }
}

function validateSysCarga(objSysCarga, strSysCarga) {
    clearAlertsInForm(objSysCarga);

    if(strSysCarga != '') {
        objSysCarga.classList.add('am-form-success');
        return true;
    } else {
        objSysCarga.classList.add('am-form-danger');
        return false;
    }
}

function validatePhone(objPhone, strPhone) {
    clearAlertsInForm(objPhone);

    if(strPhone != '' && strPhone.length === 10 && !isNaN(strPhone)) {
        objPhone.classList.add('am-form-success');
        return true;
    } else {
        objPhone.classList.add('am-form-danger');
        return false;
    }
}

function validateSysDes(objSysDes, strSysDes) {
    clearAlertsInForm(objSysDes);

    if(strSysDes != '') {
        objSysDes.classList.add('am-form-success');
        return true;
    } else {
        objSysDes.classList.add('am-form-danger');
        return false;
    }
}

function validateFletador(objFletador, strFletador) {
    clearAlertsInForm(objFletador);

    if(strFletador != '' && strFletador.length >= 10 && isNaN(strFletador)) {
        objFletador.classList.add('am-form-success');
        return true;
    } else {
        objFletador.classList.add('am-form-danger');
        return false;
    }
}

function validateRaOp1(objRaOp1, strRaOp1) {
    clearAlertsInForm(objRaOp1);

    if(strRaOp1 != '') {
        objRaOp1.classList.add('am-form-success');
        return true;
    } else {
        objRaOp1.classList.add('am-form-danger');
        return false;
    }
}

function validateService(objService, strService) {
    clearAlertsInForm(objService);

    if(strService != '') {
        objService.classList.add('am-form-success');
        return true;
    } else {
        objService.classList.add('am-form-danger');
        return false;
    }
}

function validateRaOp2(objRaOp2, strRaOp2) {
    clearAlertsInForm(objRaOp2);

    if(strRaOp2 != '') {
        objRaOp2.classList.add('am-form-success');
        return true;
    } else {
        objRaOp2.classList.add('am-form-danger');
        return false;
    }
}

function validateQuantity(objQuantity, strQuantity) {
    clearAlertsInForm(objQuantity);

    if(strQuantity != '') {
        objQuantity.classList.add('am-form-success');
        return true;
    } else {
        objQuantity.classList.add('am-form-danger');
        return false;
    }
}

function validateRaOp3(objRaOp3, strRaOp3) {
    clearAlertsInForm(objRaOp3);

    if(strRaOp3 != '') {
        objRaOp3.classList.add('am-form-success');
        return true;
    } else {
        objRaOp3.classList.add('am-form-danger');
        return false;
    }
}

function validateFleta(objFleta, strFleta) {
    clearAlertsInForm(objFleta);

    if(strFleta != '' ) {
        objFleta.classList.add('am-form-success');
        return true;
    } else {
        objFleta.classList.add('am-form-danger');
        return false;
    }
}

function validateRaOp4(objRaOp4, strRaOp4) {
    clearAlertsInForm(objRaOp4);

    if(strRaOp4 != '') {
        objRaOp4.classList.add('am-form-success');
        return true;
    } else {
        objRaOp4.classList.add('am-form-danger');
        return false;
    }
}

function validateCapacity(objCapacity, strCapacity) {
    clearAlertsInForm(objCapacity);

    if(strCapacity != '') {
        objCapacity.classList.add('am-form-success');
        return true;
    } else {
        objCapacity.classList.add('am-form-danger');
        return false;
    }
}

function clearAlertsInForm(e) {
    e.classList.remove('am-form-success');
    e.classList.remove('am-form-danger');
}

function sendContactForm() {
    $('#contactForm')[0].classList.add('uk-hidden');
    $('#contactSuccess')[0].classList.remove('uk-hidden');
}

function showNotification(message, type, position) {
    UIkit.notify(message, {status: type, timeout: 3000, position: position});
}